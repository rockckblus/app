<!DOCTYPE html>
<html manifest="http://192.168.0.25/Public/app/index.appcache" ng-app="dipan">
<head>
    <meta charset="utf-8"/>
    <title>dipan.so</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="yes"/>
    <meta http-equiv="Cache-Control" content="public"/>

    <script>
        var dist = true;//生产环境
        var basePath = 'Public/app';//跟路径
        var tplPath = '';//模板路径
        var jsPath = 'Public/app/src/js/';//js路径
        var jsDate = new Date().getFullYear() + '' + new Date().getMonth() + '' + new Date().getDate();
        var appJsPath = 'http://192.168.0.25/Public/app/dist/js/app.js';//net url app.js

        /*************************
         * plusReady 之后执行
         * 16/8/22 上午11:31 ByRockBlus
         *************************/
        function init(appPath) {

            /*************************
             * 生产环境 配置
             * 16/8/22 上午11:32 ByRockBlus
             *************************/
            if (dist) {
                if (trueWeb()) {
                    //web 端
                    document.write('<link rel="stylesheet" href="' + basePath + '/src/css/app.css"/>');
                    document.write('<link rel="stylesheet" href="' + basePath + '/src/css/responsive.css"/>');
//                document.write('<script src="' + basePath + '/dist/js/app.js?' + jsDate + '"><\/script>');
                    document.write('<script src="http://192.168.0.25/Public/app/dist/js/app.js?' + jsDate + '"><\/script>');
                } else {
                    //app端
                    document.write('<link rel="stylesheet" href="' + basePath + '/src/css/app.css"/>');
//                document.write('<script src="' + basePath + '/dist/js/app.js?' + jsDate + '"><\/script>');
                    document.write('<script src=' + appPath + '><\/script>');
                }
            }
            /*************************
             * 开发环境配置
             * 16/8/22 上午11:34 ByRockBlus
             *************************/
            else {
                if (trueWeb()) {
                    //web端
                    tplPath = 'Public/app/src/html/';//web 环境下,调试模式时候的 模板路径 全局变量

                    document.write('<link rel="stylesheet" href="' + basePath + '/src/css/app.css"/>');
                    document.write('<link rel="stylesheet" href="' + basePath + '/src/css/responsive.css"/>');
                    document.write('<script src="' + basePath + '/dist/js/appDev.js"><\/script>');
                } else {
                    //app端
                    basePath = '../..';//跟路径
                    document.write('<link rel="stylesheet" href="' + basePath + '/src/css/app.css"/>');
                    document.write('<script src="' + basePath + '/dist/js/appDev.js"><\/script>');
                }
            }


        }

        //判断web 还是 app
        function trueWeb() {
            var url = window.location.href;
            url = url.split(':');
            if (url[0] === 'http') {
                return true;
            }
        }

    </script>
    <script type="text/javascript">
        document.addEventListener('plusready', function () {
            var appJsName = '_documents/app.js';

            delAppJs();

            /*************************
             * 删除app文件
             * 16/8/22 上午11:06 ByRockBlus
             *************************/
            function delAppJs() {
                plus.io.resolveLocalFileSystemURL(appJsName, succesCb, errorCb);//判断是否存在app.js 存在就删除,然后下载,不存在,直接下载

                function succesCb(e) {
                    e.remove(function () {
                        createDownload();
                    });
                }

                function errorCb() {
                    createDownload();
                }

            }


            // 创建下载任务
            function createDownload() {

                var dtask = plus.downloader.createDownload("http://192.168.0.25/Public/app/dist/js/app.js", {
                    filename: appJsName
                }, function (d, status) {
                    // 下载完成
                    if (status == 200) {
                        plus.io.resolveLocalFileSystemURL(d.filename, function (entry) {
                            console.log('entry', entry);
                            init(entry.fullPath);
                        });
//                        alert("Download success: " + d.filename);
                    } else {
                        console.log('err', '下载文件失败,直接使用线上app.js');
                        init('http://192.168.0.25/Public/app/dist/js/app.js');
                    }
                });
                //dtask.addEventListener( "statechanged", onStateChanged, false );
                dtask.start();
            }

        });
    </script>
</head>

<body class="angularEnd" ng-controller="body">
<div class="app">
    <!-- topNavbars -->
    <div top></div>

    <div class="navbar navbar-app navbar-absolute-bottom">
        <div class="btn-group justified">
            <!--底部连接-->
            <a ui-sref="home" class="btn btn-navbar"><i class="fa fa-home fa-navbar fa-lg"></i> </a>
            <a href="#" class="btn btn-navbar"><i
                    class="fa fa-map-marker fa-navbar fa-lg"></i> </a>
            <a ui-sref="memberIndex" class="btn btn-navbar"><i
                    class="fa fa-user fa-navbar fa-lg"></i> </a>
        </div>
    </div>

    <!-- App Body -->
    <div class="app-body">

        <button id="down">下载</button>


        <!--loading directive-->
        <div loading></div>
        <div alert></div>
        <ui-view></ui-view>
    </div>

</div><!-- ~ .app -->

<!--数据div-->
<!--<div url-parse={{$indexAllRe}}></div>-->


</body>
</html>
